<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Fidelix</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .debug-item {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        .error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        .success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        .warning {
            border-left-color: #ffc107;
            background: #fff3cd;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üîç Debug do Sistema Fidelix</h1>
    
    <div class="debug-section">
        <h2>üìä Status do Sistema</h2>
        <div id="systemStatus">
            <div class="debug-item">Carregando...</div>
        </div>
    </div>
    
    <div class="debug-section">
        <h2>üè™ Lojas Cadastradas</h2>
        <div id="lojasInfo">
            <div class="debug-item">Carregando lojas...</div>
        </div>
        <button onclick="verificarLojas()">üîÑ Verificar Lojas</button>
        <button onclick="criarLojasExemplo()">‚ûï Criar Lojas Exemplo</button>
        <button onclick="limparDados()">üóëÔ∏è Limpar Dados</button>
    </div>
    
    <div class="debug-section">
        <h2>üîß Validador QR Code</h2>
        <div id="validatorInfo">
            <div class="debug-item">Verificando validador...</div>
        </div>
        <button onclick="testarValidador()">üß™ Testar Validador</button>
    </div>
    
    <div class="debug-section">
        <h2>üìù Console Log</h2>
        <div id="consoleLog">
            <div class="debug-item">Aguardando logs...</div>
        </div>
        <button onclick="limparLogs()">üßπ Limpar Logs</button>
    </div>

    <script src="js/qr-validator.js"></script>
    <script>
        // Capturar logs do console
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;
        
        function addLog(message, type = 'info') {
            const logContainer = document.getElementById('consoleLog');
            const logItem = document.createElement('div');
            logItem.className = `debug-item ${type}`;
            logItem.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            logContainer.appendChild(logItem);
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog(args.join(' '), 'success');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addLog(args.join(' '), 'warning');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addLog(args.join(' '), 'error');
        };
        
        // Fun√ß√µes de debug
        function verificarLojas() {
            const lojas = JSON.parse(localStorage.getItem('lojas') || '[]');
            const container = document.getElementById('lojasInfo');
            
            if (lojas.length === 0) {
                container.innerHTML = '<div class="debug-item error">‚ùå Nenhuma loja encontrada no localStorage</div>';
            } else {
                container.innerHTML = `
                    <div class="debug-item success">‚úÖ ${lojas.length} lojas encontradas</div>
                    ${lojas.map(loja => `
                        <div class="debug-item">
                            <strong>üè™ ${loja.nome}</strong><br>
                            ID: ${loja.id} | Endere√ßo: ${loja.endereco}<br>
                            Cupons: ${loja.cupons.length}
                        </div>
                    `).join('')}
                `;
            }
        }
        
        function criarLojasExemplo() {
            const lojas = [
                {
                    id: 1,
                    nome: 'Supermercado Central',
                    endereco: 'Rua das Flores, 123',
                    telefone: '(11) 9999-9999',
                    comprasNecessarias: 5,
                    cupons: [
                        { desconto: 10, validade: '30 dias', comprasNecessarias: 5 },
                        { desconto: 20, validade: '30 dias', comprasNecessarias: 10 }
                    ]
                },
                {
                    id: 2,
                    nome: 'Farm√°cia Popular',
                    endereco: 'Av. Principal, 456',
                    telefone: '(11) 8888-8888',
                    comprasNecessarias: 3,
                    cupons: [
                        { desconto: 15, validade: '15 dias', comprasNecessarias: 3 },
                        { desconto: 25, validade: '30 dias', comprasNecessarias: 6 }
                    ]
                },
                {
                    id: 3,
                    nome: 'Loja de Roupas Fashion',
                    endereco: 'Shopping Center, Loja 78',
                    telefone: '(11) 7777-7777',
                    comprasNecessarias: 2,
                    cupons: [
                        { desconto: 20, validade: '60 dias', comprasNecessarias: 2 },
                        { desconto: 30, validade: '90 dias', comprasNecessarias: 5 }
                    ]
                }
            ];
            
            localStorage.setItem('lojas', JSON.stringify(lojas));
            addLog('‚úÖ Lojas de exemplo criadas com sucesso!', 'success');
            verificarLojas();
        }
        
        function limparDados() {
            localStorage.removeItem('lojas');
            localStorage.removeItem('compras');
            localStorage.removeItem('cupons');
            localStorage.removeItem('historico');
            addLog('üóëÔ∏è Todos os dados foram limpos!', 'warning');
            verificarLojas();
        }
        
        function testarValidador() {
            const container = document.getElementById('validatorInfo');
            
            if (typeof QRCodeValidator === 'undefined') {
                container.innerHTML = '<div class="debug-item error">‚ùå QRCodeValidator n√£o encontrado</div>';
                return;
            }
            
            try {
                const validator = new QRCodeValidator();
                const lojas = JSON.parse(localStorage.getItem('lojas') || '[]');
                validator.setLojas(lojas);
                
                // Testar valida√ß√£o
                const teste1 = validator.validar('Supermercado Central');
                const teste2 = validator.validar('Empresa Inexistente');
                
                container.innerHTML = `
                    <div class="debug-item success">‚úÖ Validador funcionando corretamente</div>
                    <div class="debug-item">
                        <strong>Teste 1 (Supermercado Central):</strong><br>
                        V√°lido: ${teste1.valido} | Mensagem: ${teste1.valido ? 'OK' : teste1.mensagem}
                    </div>
                    <div class="debug-item">
                        <strong>Teste 2 (Empresa Inexistente):</strong><br>
                        V√°lido: ${teste2.valido} | Mensagem: ${teste2.valido ? 'OK' : teste2.mensagem}
                    </div>
                `;
                
                addLog('‚úÖ Teste do validador conclu√≠do com sucesso!', 'success');
            } catch (error) {
                container.innerHTML = `<div class="debug-item error">‚ùå Erro no validador: ${error.message}</div>`;
                addLog(`‚ùå Erro no validador: ${error.message}`, 'error');
            }
        }
        
        function limparLogs() {
            document.getElementById('consoleLog').innerHTML = '<div class="debug-item">Aguardando logs...</div>';
        }
        
        function verificarStatus() {
            const container = document.getElementById('systemStatus');
            const lojas = JSON.parse(localStorage.getItem('lojas') || '[]');
            const compras = JSON.parse(localStorage.getItem('compras') || '[]');
            const cupons = JSON.parse(localStorage.getItem('cupons') || '[]');
            const historico = JSON.parse(localStorage.getItem('historico') || '[]');
            
            container.innerHTML = `
                <div class="debug-item ${lojas.length > 0 ? 'success' : 'error'}">
                    üè™ Lojas: ${lojas.length} ${lojas.length > 0 ? '‚úÖ' : '‚ùå'}
                </div>
                <div class="debug-item ${compras.length > 0 ? 'success' : 'warning'}">
                    üõí Compras: ${compras.length} ${compras.length > 0 ? '‚úÖ' : '‚ö†Ô∏è'}
                </div>
                <div class="debug-item ${cupons.length > 0 ? 'success' : 'warning'}">
                    üé´ Cupons: ${cupons.length} ${cupons.length > 0 ? '‚úÖ' : '‚ö†Ô∏è'}
                </div>
                <div class="debug-item ${historico.length > 0 ? 'success' : 'warning'}">
                    üìö Hist√≥rico: ${historico.length} ${historico.length > 0 ? '‚úÖ' : '‚ö†Ô∏è'}
                </div>
                <div class="debug-item ${typeof QRCodeValidator !== 'undefined' ? 'success' : 'error'}">
                    üîß Validador QR: ${typeof QRCodeValidator !== 'undefined' ? '‚úÖ Dispon√≠vel' : '‚ùå N√£o encontrado'}
                </div>
            `;
        }
        
        // Inicializar p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            addLog('üöÄ P√°gina de debug carregada', 'success');
            verificarStatus();
            verificarLojas();
            testarValidador();
        });
    </script>
</body>
</html>
